<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Matomo + Stripe MVP test</title>

  <!-- Matomo -->
  <script>
    var _paq = window._paq = window._paq || [];
    window.session_id = 'sess_' + crypto.randomUUID();

    var u = "https://stripemtm.matomo.cloud/";
    _paq.push(['setTrackerUrl', u + 'matomo.php']);
    _paq.push(['setSiteId', '1']);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);

    (function() {
      var d = document,
          g = d.createElement('script'),
          s = d.getElementsByTagName('script')[0];
      g.async = true;
      g.src = u + 'matomo.js';
      s.parentNode.insertBefore(g, s);
    })();
  </script>
  <!-- End Matomo -->
</head>
<body>
  <h1>Matomo + Stripe MVP test</h1>

  <p><strong>Session ID (для отладки):</strong></p>
  <pre id="sid"></pre>

  <button id="buyBtn">Buy → Stripe</button>

  <script>
    document.getElementById('sid').textContent = window.session_id;

    document.getElementById('buyBtn').addEventListener('click', function () {
      _paq.push([
        'trackEvent',
        'payment',
        'redirect_to_stripe',
        window.session_id
      ]);

      const stripePaymentLink =
        'https://buy.stripe.com/test_8x2fZh7x0e8fc8l3brbsc01' +
        '?client_reference_id=' + encodeURIComponent(window.session_id);

      window.location.href = stripePaymentLink;
    });
  </script>
</body>
</html>
